<!DOCTYPE html>
    <meta>
    <title>WEB API</title>
    </meta>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    </head>
    <body>
        <h1>WEB API</h1>
        <input id="username" type="text" placeholder="input username">
        <button id="userConfirm">Set user</button>
        <div id="user"></div>
        <ul>
            <li>
                <p>Select city by id</p>
                <input id="cityID" type="number" placeholder="city id"><br>
                <button id="getCityByID">Select</button>
            </li>
            <li>
                <p>Post country with name</p>
                <input id="CountryName" type="text" placeholder="Country name"><br>
                <button id="postCountry">Post</button>
            </li>
            <li>
                <p>Get countries</p>
                <button id="getCountries">Get</button>
            </li>
            <li>
                <p>Delete country by ID</p>
                <input id="deleteCountryById" type="number" placeholder="CountryId"><br>
                <button id="deleteCountry">Delete</button>
            </li>
            <li>
                <p>Update Country name</p>
                <input id="putCountryID" type="number" placeholder="Country id"><br>
                <input id="putCountryName" type="text" placeholder="Country name"><br>
                <button id="putCountry">Put</button>
            </li>
        </ul>
        <div id="responseField"></div>
        <script type="text/javascript">
            //UserMo
            $(document).ready(function(){
                let username = $("#username").val();
                $("#userConfirm").click(function(){
                    $("#user").empty();
                    username = $("#username").val();
                    $("#user").append(username);
                })
                let URI = "https://cityinfo.buchwaldshave34.dk/api/City/"
                $("#getCityByID").click(function(){
                    $("#responseField").empty();
                    let cityID = $("#cityID").val();
                    $.ajax({
                        method: "GET",
                        url: URI + cityID+"?includeRelations=true&UserName=" + username,
                        dataType: 'JSON',
                        statusCode: {
                            400: function(){
                                alert("Bad request");
                            }
                        }
                    }).done(function (response){
                        
                        var id = response.cityId;
                        var cityName = response.name;
                        var tr_str = "<tr><th>ID</th><th>Language</th>"+
                            "<tr><td align='center'>" + id + "</td>" 
                            +"<td align='center'>" + cityName + "</td></tr>"
                        $("#responseField").append(tr_str);
                    })
                });
                $("#postCountry").click(function(){
                    let CountryID = $("#CountryID").val();
                    let Country = {
                        countryName: $("#CountryName").val()
                    };
                    $.ajax({
                        method: "POST",
                        url: URI + "Country?" + "UserName=" + username,
                        dataType: "json",
                        contentType: 'application/json',
                        data: JSON.stringify(Country),
                        statusCode: {
                            400: function(){
                                alert("Bad request");
                            }
                        } 
                    }).done(function (response){
                        alert("New country with ID: " + response);
                        
                    });
                });
                $("#getCountries").click(function(){
                    $("#responseField").empty();
                    $.ajax({
                        method: "GET",
                        url: URI + "Country?includeRelations=true&" + "UserName=" + username
                    }).done(function(response){
                        var len = response.length;
                        $("#responseField").append("<tr><th>ID</th><th>Name</th></tr>")
                        for(var i=0; i<len; i++){
                            var countryID = response[i].countryID;
                            var countryName = response[i].countryName;

                            var tr_str = "<tr>" +
                                "<td align='left'>" + countryID + "</td>" +
                                "<td align='right'>" + countryName + "</td>" +
                                "</tr>"; 

                            $("#responseField").append(tr_str);
                        }
                    });
                });
                $("#deleteCountry").click(function(){
                    $("#responseField").empty();
                    let countryID = $("#deleteCountryById").val();
                    $.ajax({
                        method: "DELETE",
                        url: URI + "Country/" + countryID + "?UserName=" + username,
                        statusCode: {
                            400: function(){
                                alert("Bad request");
                            },
                            405: function(){
                                alert("Not allowed");
                            }
                        }
                    }).done(function (response){
                        alert("Country with ID: " + countryID + " deleted");
                    })  
                });
                $("#putCountry").click(function(){
                    $("#responseField").empty();
                    let countryID = $("#putCountryID").val();
                    let country = {
                        countryName: $("#putCountryName").val(),
                        countryID: $("#putCountryID").val()
                    };
                    $.ajax({
                        method: "PUT",
                        url: URI + "Country/" + countryID + "?UserName=" + username,
                        dataType: "json",
                        contentType: 'application/json',
                        data: JSON.stringify(country),
                        statusCode: {
                            400: function(){
                                alert("Bad request");
                            },
                            405: function(){
                                alert("Not allowed");
                            }
                        }
                    }).done(function (response){
                        alert("Country with ID: " + countryID + " updated");
                    })  
                })
            });  
        </script>
    </body>
    